# -*- coding: utf-8 -*-
"""
@author: Salvatore Iacoletti
"""

import numpy as np
import matplotlib.pyplot as plt


class RecordPair():
    '''
    Container for a pair of ground-motion records
    '''
    
    LAG_T_STEP = 0.1
    
    def __init__(self, rec1, rec2, lag=50., sf1=1., sf2=1.):
        '''
        rec1: ground motion record 1 (first) - instance of Record
        rec2: ground motion record 2 (second) - instance of Record
        lag: time (s) between rec1 and rec2
        '''
        self.rec1_orig = rec1
        self.rec2_orig = rec2
        self.sf1 = sf1
        self.sf2 = sf2
        if sf1 == 1.:
            self.rec1 = rec1
        else:
            self.rec1 = rec1.scale(sf1)
        if sf2 == 1.:
            self.rec2 = rec2
        else:
            self.rec2 = rec2.scale(sf2)
        self.lag = lag
    
    @property
    def time_lag(self):
        time1 = self.rec1.time
        time_lag = np.arange(time1[-1] + self.LAG_T_STEP,
                             time1[-1] + self.lag + self.LAG_T_STEP,
                             self.LAG_T_STEP)
        return time_lag
    
    @property
    def end_rest_time(self):
        return self.time_lag[-1]
    
    @property
    def time(self):
        time1 = self.rec1.time
        time_lag = self.time_lag
        time2 = time_lag[-1] + self.LAG_T_STEP + self.rec2.time
        return np.hstack([time1, time_lag, time2])
    
    @property
    def num_points(self):
        return len(self.time)

    @property
    def duration(self):
        return self.time[-1]

    @property
    def gmr(self):
        return np.hstack([self.rec1.gmr, [0.]*self.time_lag.shape[0], self.rec2.gmr])


    def get_gmr(self, unit="m/s2"):
        if unit == "g":
            return self.gmr/9.81
        elif unit == "m/s2":
            return self.gmr
        else:
            raise Exception("unit can only be 'g' or 'm/s2'")


    def get_time_gmr(self, unit="m/s2"):
        return np.vstack([self.time, self.get_gmr(unit)]).T


    def plot_acc(self, unit="m/s2", ax=None):
        '''
        quick and dirty plot to check
        '''
        if ax is None:
            fig, ax = plt.subplots()
        ax.set_xlabel("Time (s)")
        if unit == "g":
            ax.set_ylabel("Acceleration (g)")
        elif unit == "m/s2":
            ax.set_ylabel("Acceleration (m/s2)")
        else:
            raise Exception("unit can only be 'g' or 'm/s2'")
        ax.plot(self.time, self.get_gmr(unit))
        plt.show()
        return ax


    def __repr__(self):
        return self.__str__()
        
    def __str__(self):
        string = "<{} ".format(self.__class__.__name__) + \
               str(self.rec1) + ", " + \
               "lag: {:.0f}".format(self.lag) + "s, " + \
               str(self.rec2)
        return string+">"

