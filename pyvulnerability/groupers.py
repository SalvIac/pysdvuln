# -*- coding: utf-8 -*-
"""
@author: Salvatore
"""

import numpy as np



class BaseGrouper():
    
    def __init__(self, centerbin, bins):
        '''
        centerbin: n periods for each category
        bins: numpy 1d array (n+1,)
        '''
        if len(centerbin)+1 != len(bins):
            raise Exception("length of centerbin ({}) and bins ({}) are not consistent.".format(
                len(centerbin), len(bins)))
        self.centerbin = centerbin
        self.bins = bins
            
    def get_index(self, value):
        return np.searchsorted(self.bins, value)-1

    def __call__(self, value):
        return self.centerbin[self.get_index(value)]
    


class PeriodGrouper(BaseGrouper):
    
    def __init__(self, periods=None, bins=None):
        # default for Iacoletti et al. (2022)
        if periods is None:
            periods = np.array([0.05, 0.2, 0.4, 0.6, 0.8, 1., 1.5, 2.])
            bins = np.hstack([[0.], periods[:-1] + np.diff(periods)/2, [10.]])
            bins[1] = 0.1
        super().__init__(periods, bins)



class YieldCapGrouper(BaseGrouper):
    
    def __init__(self, yielding=None, bins=None):
        # default for Iacoletti et al. (2022)
        if yielding is None:
            yielding = np.arange(1., 3.1, 0.5) # in g
            bins = np.hstack([[0.], yielding/2])
            bins[-1] = 10. # impose a max of 3g
        super().__init__(yielding, bins)

