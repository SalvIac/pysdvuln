# -*- coding: utf-8 -*-
"""
@author: Salvatore Iacoletti
"""

import numpy as np
import matplotlib.pyplot as plt
import pandas as pd
import openseespy.opensees as ops
from myutils.search_file_in_folder import (search_filenames_in_folder,
                                           search_filepaths_in_folder)
from pyvulnerability.base_sdof import material_martins_silva


if __name__ == '__main__':
    
    # base = r"C:\Users\Salvatore\Documents\GitHub/"
    base = r"C:\Users\Salvatore\Dropbox\SalvIac/"
    path = base+"global_fragility_vulnerability\capacity/"
    names = search_filenames_in_folder(path)
    classes = [name.replace(".csv", "") for name in names]
    
    filepaths = search_filepaths_in_folder(path)
    
    
    fig, ax = plt.subplots(1,1)

    periods = dict()
    
    for file, cl in zip(filepaths, classes):
        capacity_curve = pd.read_csv(file).to_numpy()
        
        if capacity_curve.shape[0] > 3:
            mask = np.ones(len(capacity_curve), dtype=bool)
            mask[[1]] = False
            capacity_curve2 = capacity_curve[mask,:]
        else:
            capacity_curve2 = capacity_curve
            
        ax.plot(capacity_curve[:,0], capacity_curve[:,1], marker="o",
                markersize=2, color=[0.5,0.5,0.5])
        
        ops.wipe()
        _, period1 = material_martins_silva(capacity_curve, degradation=True)
        ops.wipe()
        _, periody = material_martins_silva(capacity_curve2, degradation=True)
        periods[cl] = {"T1": period1, "Ty": periody}
        
    ax.set_xlabel("Sd [m]")
    ax.set_ylabel("Sa [g]")
    
    plt.show()

    