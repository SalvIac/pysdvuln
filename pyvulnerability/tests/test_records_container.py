# -*- coding: utf-8 -*-
"""
@author: Salvatore Iacoletti
"""

import numpy as np
from tqdm import tqdm
from pyvulnerability.records_container import RecordsContainer


#%%

if __name__ == "__main__":
   
    base = r"C:\Users\Salvatore\Dropbox\SalvIac\pyvulnerability\ground_motion_databases"

    rc = RecordsContainer(base)
    
    r0 = rc.get_sas(0.)
    r001 = rc.get_sas(0.01)
    r02 = rc.get_sas(0.2)
    r05 = rc.get_sas(0.5)
    ravg = rc.get_avgsas(0.5)

    ims = ravg

    rc.get_pair_combos(ims, plot=True)
    rc.get_distr_im(ims, numbins=50, plot=True, imt="IM (m/s2)")
    
    rc.sample1d_ind(ims, num=500)
    rc.sample2d_ind(ims, num=500, plot=True, imt="IM (m/s2)")
    
    rc.sample1d_im(ims, num=500, numbins=50)
    rc.sample2d_im(ims, num=500, numbins=50, plot=True, imt="IM (m/s2)")
    
    # todelete = rc.check_duplicates()
    # rc.delete_records(inds)
    # rc.combine_gmrs([1,2])

    #%%
    
    from pyvulnerability import geneticalgorithm as ga
    
    algorithm_param = {'max_num_iteration': 1e3,
                       'population_size': 100,
                       'mutation_probability': 0.1,
                       'elit_ratio': 0.01,
                       'crossover_probability': 0.5,
                       'parents_portion': 0.3,
                       'crossover_type':'uniform',
                       'max_iteration_without_improv': 1e3}
    
        
    # varbound=np.array([[0.5,1.5],[1,100],[0.5,1.5],[0,100]])
    varbound=np.array([[0,len(rc.records)]]*2*500)
    # vartype=np.array([['real'],['int'],['real'],['int']])
    vartype=np.array([['int']]*2*500)

    model = ga(function=rc.fitness_pair_simple, dimension=2*500,
               variable_type_mixed=vartype, variable_boundaries=varbound,
               algorithm_parameters=algorithm_param)
    
    model.run()
    
    convergence = model.report
    
    solution = model.output_dict

    
    
    
    
    
    
    
