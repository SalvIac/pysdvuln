# -*- coding: utf-8 -*-
"""
@author: Salvatore Iacoletti
"""

import os
from copy import deepcopy
import pandas as pd
import matplotlib.pyplot as plt
from pyvulnerability.records_container import RecordsContainer
from pyvulnerability.selector import Selector


if __name__ == "__main__":
   
    base = r"C:\Users\Salvatore\Dropbox\SalvIac\ground_motion_databases"
    rc = RecordsContainer.load_ngawest2_data(base)
    rsns = rc.get_array("rsn")
    ravg = rc.get_avgsas_T(0.12)

    sel = Selector(ravg, rc)
    combos = sel.get_pair_combos()
    sel.scatter(combos[:,0], combos[:,1], s=2)
    xlim = plt.gca().get_xlim()
    ylim = plt.gca().get_ylim()
    
    
    #%% peer classification

    df_p = pd.read_csv(os.path.join(base, "NGAWest2", "pulse_like_peer.csv"))
    pulse_rsn = df_p['Record Seq. #'].to_list()
    ord_rsn = [i for i,rsn in enumerate(rsns) if rsn not in pulse_rsn]
   
    rc_p = deepcopy(rc)
    rc_p.delete_records(ord_rsn)
    ravg = rc_p.get_avgsas_T(0.12)
    
    sel = Selector(ravg, rc_p)
    combos = sel.get_pair_combos()
    sel.scatter(combos[:,0], combos[:,1], s=2)
    xlim = plt.gca().get_xlim()
    ylim = plt.gca().get_ylim()


    #%% baker classification

    df_b = pd.read_csv(os.path.join(base, "NGAWest2", "pulse_like_baker.csv"))
    pulse_rsn = df_b['NGA Record Sequence Number'].to_list()
    ord_rsn = [i for i,rsn in enumerate(rsns) if rsn not in pulse_rsn]
   
    rc_b = deepcopy(rc)
    rc_b.delete_records(ord_rsn)
    ravg = rc_b.get_avgsas_T(0.12)

    sel = Selector(ravg, rc_p)
    combos = sel.get_pair_combos()
    sel.scatter(combos[:,0], combos[:,1], s=2)
    xlim = plt.gca().get_xlim()
    ylim = plt.gca().get_ylim()


    